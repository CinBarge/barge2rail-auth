{% extends "admin/base_site.html" %}
{% load i18n %}

{% block extrahead %}
{{ block.super }}
<style>
    .rbac-dashboard {
        padding: 20px;
    }
    .stats-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    .stat-card {
        background: #e8f4e8;
        border-left: 4px solid #005500;
        padding: 20px;
        border-radius: 4px;
    }
    .stat-card .number {
        font-size: 36px;
        font-weight: bold;
        color: #005500;
    }
    .stat-card .label {
        color: #666;
        margin-top: 5px;
    }
    .tools-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
    }
    .tool-card {
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        text-decoration: none;
        color: inherit;
        transition: all 0.2s;
    }
    .tool-card:hover {
        border-color: #005500;
        box-shadow: 0 4px 12px rgba(0,85,0,0.15);
        transform: translateY(-2px);
    }
    .tool-card h3 {
        color: #005500;
        margin: 0 0 10px 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .tool-card p {
        color: #666;
        margin: 0;
        font-size: 14px;
    }
    .tool-icon {
        font-size: 24px;
    }
    .section-title {
        color: #005500;
        border-bottom: 2px solid #005500;
        padding-bottom: 10px;
        margin: 30px 0 20px 0;
    }
</style>
{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">Home</a>
    &rsaquo; <a href="{% url 'admin:app_list' app_label='sso' %}">SSO</a>
    &rsaquo; RBAC Management
</div>
{% endblock %}

{% block content %}
<div class="rbac-dashboard">
    <h1>RBAC Management Dashboard</h1>

    <div class="stats-row">
        <div class="stat-card">
            <div class="number">{{ stats.active_roles }}</div>
            <div class="label">Active Roles</div>
        </div>
        <div class="stat-card">
            <div class="number">{{ stats.total_users_with_roles }}</div>
            <div class="label">Users with Roles</div>
        </div>
        <div class="stat-card">
            <div class="number">{{ stats.total_permissions }}</div>
            <div class="label">Permission Assignments</div>
        </div>
        <div class="stat-card">
            <div class="number">{{ stats.total_roles }}</div>
            <div class="label">Total Roles</div>
        </div>
    </div>

    <h2 class="section-title">User & Permission Tools</h2>
    <div class="tools-grid">
        <a href="{% url 'sso_effective_permissions' %}" class="tool-card">
            <h3><span class="tool-icon">&#128100;</span> Effective Permissions</h3>
            <p>See what a specific user can actually do across all their roles. Answer "Can Bob delete invoices?"</p>
        </a>
        <a href="{% url 'sso_permission_search' %}" class="tool-card">
            <h3><span class="tool-icon">&#128269;</span> Permission Search</h3>
            <p>Find which roles have specific permissions. "Who can approve BOLs?"</p>
        </a>
        <a href="{% url 'sso_bulk_assign_role' %}" class="tool-card">
            <h3><span class="tool-icon">&#128101;</span> Bulk Assignment</h3>
            <p>Assign multiple users to a role at once. Great for onboarding teams.</p>
        </a>
    </div>

    <h2 class="section-title">Role Management</h2>
    <div class="tools-grid">
        <a href="{% url 'admin:sso_role_changelist' %}" class="tool-card">
            <h3><span class="tool-icon">&#128736;</span> Manage Roles</h3>
            <p>View, create, and edit roles. Use the permission matrix for fine-grained control.</p>
        </a>
        <a href="{% url 'sso_compare_roles' %}" class="tool-card">
            <h3><span class="tool-icon">&#8646;</span> Compare Roles</h3>
            <p>Side-by-side comparison of two roles. Find differences and similarities.</p>
        </a>
    </div>

    <h2 class="section-title">Import / Export</h2>
    <div class="tools-grid">
        <a href="{% url 'sso_export_roles' %}" class="tool-card">
            <h3><span class="tool-icon">&#128229;</span> Export Roles</h3>
            <p>Download roles and permissions as JSON. Backup before changes or migrate between environments.</p>
        </a>
        <a href="{% url 'sso_import_roles' %}" class="tool-card">
            <h3><span class="tool-icon">&#128228;</span> Import Roles</h3>
            <p>Upload roles from JSON file. Restore from backup or import from another environment.</p>
        </a>
    </div>

    <h2 class="section-title">Quick Links</h2>
    <div class="tools-grid">
        <a href="{% url 'admin:sso_feature_changelist' %}" class="tool-card">
            <h3><span class="tool-icon">&#9881;</span> Features</h3>
            <p>Manage features that can have permissions assigned.</p>
        </a>
        <a href="{% url 'admin:sso_permission_changelist' %}" class="tool-card">
            <h3><span class="tool-icon">&#128274;</span> Base Permissions</h3>
            <p>View and manage base permission types (view, create, modify, etc.)</p>
        </a>
        <a href="{% url 'admin:sso_userapprole_changelist' %}" class="tool-card">
            <h3><span class="tool-icon">&#128100;</span> User Role Assignments</h3>
            <p>View all user-to-role assignments across the system.</p>
        </a>
    </div>
</div>
{% endblock %}
