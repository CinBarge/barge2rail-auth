{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrahead %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'sso/css/rbac-theme.css' %}">
{% endblock %}

{% block bodyclass %}{{ block.super }} rbac-page{% endblock %}

{% block content_title %}{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">Home</a>
    &rsaquo; <a href="{% url 'admin:app_list' app_label='sso' %}">SSO</a>
    &rsaquo; <a href="{% url 'sso_rbac_dashboard' %}">RBAC</a>
    &rsaquo; Import Roles
</div>
{% endblock %}

{% block content %}
{% if messages %}
<div class="toast-container">
    {% for message in messages %}
    <div class="toast {% if message.tags %}{{ message.tags }}{% endif %}">
        {{ message }}
    </div>
    {% endfor %}
</div>
{% endif %}

<h1>Import Roles</h1>
<p>Upload roles and permissions from a JSON file.</p>

<form method="post" enctype="multipart/form-data" class="rbac-form">
    {% csrf_token %}

    <div class="warning-box">
        <strong>Warning:</strong> Importing will update existing roles if they match by application + code.
        Permissions for matching roles will be replaced with the imported values.
    </div>

    <div class="form-group">
        <label for="file">JSON File:</label>
        <input type="file" name="file" id="file" accept=".json" required>
        <p class="help-text">Select a JSON file exported from the RBAC export tool.</p>
    </div>

    <div class="submit-row">
        <button type="submit" class="btn-primary">Import Roles</button>
        <a href="{% url 'sso_rbac_dashboard' %}" class="btn-secondary">Cancel</a>
    </div>
</form>

<div class="format-info">
    <h4>Expected JSON Format:</h4>
    <pre>{
  "exported_at": "2024-01-15T10:30:00Z",
  "roles": [
    {
      "application": "primetrade",
      "code": "admin",
      "name": "Administrator",
      "description": "Full access",
      "legacy_role": "Admin",
      "permissions": {
        "bol": ["view", "create", "modify", "delete"],
        "reports": ["view", "export"]
      }
    }
  ]
}</pre>
</div>

<script>
setTimeout(function() {
    document.querySelectorAll('.toast').forEach(toast => {
        toast.style.opacity = '0';
        setTimeout(() => toast.remove(), 300);
    });
}, 5000);
</script>
{% endblock %}
